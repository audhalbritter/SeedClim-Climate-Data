---
title: "Science Paper Supplementary Material"
author: "Aud Halbritter"
date: "27 6 2017"
output: word_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = TRUE, dpi = 300)
```

```{r loadStuff, echo = FALSE}
#Load libraries
library("lubridate")
library("tidyverse")
library("ggplot2")

#load data
load("temperaturedata.Rdata")
load("monthlyTemperaturedata.RData")
load("monthlyClimate2.Rdata")

Longterm <- data_frame(T_level = as.factor(c(rep("boreal", 4), rep("subalpine", 4), rep("alpine", 4))),
                       P_level = as.factor(c(rep(c(1,2,3,4),3))),
                       P_mean = c(600, 1161, 2044, 2923, 789, 1356, 1848, 3029, 596, 1321, 1925, 2725),
                       T_mean = c(10.3, 10.55, 10.6, 10.78, 9.14, 9.17, 8.77, 8.67, 6.17, 6.45, 5.87, 6.58),
                       logger = "30 year normal")


```


##  Climate data
The climate grid (Figure 1 in main text) was set up on the basis of downscaled climate data (data from met.no). In this supplement we explore patterns weather data measured locally at the SeedClim sites to confirm the climate grid with groud data.

# Temperature
Monthly averages of local temperature measurements differ consistently among boreal, sub-alpine and alpine sites during summer, for air (Figure S1.1) and ground temperatures (not shown). The differences are less clear during spring, autumn and winter.

```{r, echo=FALSE} 
monthlyTemperaturedata %>% 
  filter(logger == "temp200cm") %>% 
  mutate(T_level = factor(T_level, levels = c("boreal","subalpine","alpine"))) %>% 
  group_by(T_level, date) %>% 
  summarise(mean = mean(value, na.rm = TRUE)) %>% 
  ggplot(aes(x = date, y = mean, color = T_level)) +
  geom_line(size = 0.6) +
  labs(x = "", y = "Monthly air temperature in °C") +
  scale_color_manual(name = "Temperature level", values = c("darkred", "red", "orange")) +
  theme_minimal()

```

Figure S1.1. Time series of monthly average temperature for boreal (darlred), sub-alpine (red) and alpine (orange) sites measured at 2m above ground.


# Precipitation
The precipitation data are much noisier than the temperature data (more missing values and outliers), due to logger failure and also because precipitation partly falls as snow. Here the annual gridded data for 1960-90 (www.met.no) is used.

```{r, echo=FALSE} 
monthlyClimate2 %>% 
  filter(logger == "Precipitation") %>% 
  group_by(P_level, date) %>% 
  summarise(mean = mean(value, na.rm = TRUE)) %>% 
  ggplot(aes(x = date, y = mean, color = P_level)) +
  geom_line(size = 0.6) +
  labs(x = "", y = "Monthly precipitation in mm") +
  scale_color_manual(name = "Precipitation level", values = c("lightsteelblue1", "skyblue1", "steelblue3", "midnightblue")) +
  theme_minimal()
```

Figure S1.2. Time series of sum of monthly precipitation averaged across sites for each precipitation level according to increasing precipitation levels (500mm, 1200mm, 2000mm, 2700mm) from light to dark blue. 


# Climate grid
The grid was set up with annual precipitaiton and tetraterm temperatures, i.e. averages of the months May, June, July, August from gridded data for the period of the experiment (7 years). Also shown are the 30 year normal temperature for the period of 1960-90 (www.met.no). This data confirm the grid.

```{r, echo=FALSE}

# Filter precipitation and tetraterm temperature
monthlyClimate2 %>% 
  filter(logger == "Temperature" & month(date) %in% 6:9 | logger == "Precipitation") %>% 
  filter(year(date) != 2016) %>% 
  group_by(logger, T_level, P_level, year(date)) %>% 
  summarise(n = n(), mean = mean(value, na.rm = TRUE), sum = sum(value, na.rm = TRUE)) %>% 
  mutate(mean = ifelse(logger == "Precipitation", sum, mean)) %>% 
  group_by(logger, T_level, P_level) %>% 
  summarise(N = n(), Mean = mean(mean), SE = sd(mean, na.rm = TRUE) / sqrt(N)) %>% 
  unite(Mean_SE, Mean, SE, sep = "_") %>% 
  spread(key = logger, value = Mean_SE) %>% 
  separate(col = Precipitation, into = c("P_mean", "P_se"), sep = "_", convert = TRUE) %>% 
  separate(col = Temperature, into = c("T_mean", "T_se"), sep = "_", convert = TRUE) %>%
  select(-N) %>% 
  mutate(logger = "7 year gridded") %>% 
  bind_rows(Longterm) %>%
  ungroup() %>% 
  mutate(P_level = factor(P_level, levels = c(1,2,3,4))) %>% 
  mutate(T_level = factor(T_level, levels = c("boreal", "subalpine", "alpine"))) %>% 
  ggplot(aes(x = P_mean, xmin = P_mean - P_se, xmax = P_mean + P_se, y = T_mean, ymin = T_mean -T_se, ymax = T_mean + T_se, color = P_level, shape = T_level, fill = factor(ifelse(logger == "7 year gridded", P_level, logger)))) +
  geom_errorbar() +
  geom_errorbarh() +
  geom_point(aes(size = logger)) +
  labs(x = "Annual precipitation in mm", y = "Tetraterm temperature in °C") +
  scale_color_manual(name = "Precipitation level", values = c("lightsteelblue1", "skyblue1", "steelblue3", "midnightblue")) +
  scale_shape_manual(name = "Temperature level", values = c(25, 21, 24)) +
  scale_fill_manual(name = "Data", values = c("lightsteelblue1", "skyblue1", "steelblue3", "white", "midnightblue")) +
  scale_size_manual(name = "Source", values = c(3, 3.01))+
  guides(fill = "none", size = guide_legend(override.aes = list(shape = c(1, 16)))) +
  theme_minimal()
```

Figure S1.3. Grid of precipitation and tetraterm temperatures with means of observations across years ± SE (vertical and horizontal error bars). Colors from light to dark blue are according to increasing precipitation levels (500mm, 1200mm, 2000mm, 2700mm). The shape of the symbols represent the temperature levels (boreal: reverse triangle, sub-alpine: circle, alpine: triangle). Closed symbols represent the gridded data over the 7 years of the experiment. Open symbols show the 30 year normal climate data.


