---
title: "Science Paper Supplementary Material"
author: "Aud Halbritter"
date: "27 6 2017"
output: word_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = TRUE, dpi = 300)
```

```{r loadStuff, echo = FALSE}
#Load libraries
library("lubridate")
library("tidyverse")

#load data
load("temperaturedata.Rdata")
load("monthlyTemperaturedata.RData")
load("monthlyClimate2.Rdata")

```


##  Climate data
The climate grid (Figure 1 in main text) was set up on the basis of downscaled climate data (data from met.no). In this supplement we explore patterns weather data measured locally at the SeedClim sites to confirm the climate grid with groud data.

# Temperature
Monthly averages of local temperature measurements differ consistently among alpine, sub-alpine and boreal sites during summer, for air (Figure S1.1) and ground temperatures (not shown). The differences are less clear during spring, autumn and winter.

```{r, echo=FALSE} 
monthlyTemperaturedata %>% 
  filter(logger == "temp200cm") %>% 
  mutate(T_level = factor(T_level, levels = c("boreal","subalpine","alpine"))) %>% 
  group_by(T_level, date) %>% 
  summarise(mean = mean(value, na.rm = TRUE)) %>% 
  ggplot(aes(x = date, y = mean, color = T_level)) +
  geom_line() +
  labs(x = "", y = "Monthly air temperature in °C") +
  scale_color_manual(name = "Temperature level", values = c("darkred", "red", "orange")) +
  theme_minimal()

```

Figure S1.1. Time series of monthly average temperature for alpine (orange), sub-alpine (red) and boreal (darlred) sites measured at 2m above ground.


# Precipitation
The precipitation data are much noisier than the temperature data (more missing values and outliers), due to bucket/logger failure, but also because much precipitation comes as snow. Here the annual gridded data for 1960-90 (www.met.no) is used.

```{r, echo=FALSE} 
monthlyClimate2 %>% 
  filter(logger == "Precipitation") %>% 
  group_by(P_level, date) %>% 
  summarise(mean = mean(value, na.rm = TRUE)) %>% 
  ggplot(aes(x = date, y = mean, color = P_level)) +
  geom_line(size = 0.8) +
  labs(x = "", y = "Monthly precipitation in mm") +
  scale_color_manual(name = "Precipitation level", values = c("lightsteelblue1", "skyblue1", "steelblue3", "midnightblue")) +
  theme_minimal()
```

Figure S1.2. Time series of sum of monthly precipitation averaged across sites for each precipitation level according to increasing precipitation levels (500mm, 1200mm, 2000mm, 2700mm) from light to dark blue. 


# Climate grid
The grid was set up with annual precipitaiton and tetraterm temperatures, i.e. averages of the months May, June, July, August from gridded data for 1960-90 (www.met.no).
When tetraterm temperatures are plotted against total annual precipitation estimated from the met.no 1km time series, we see that the grid is confirmed.

```{r, echo=FALSE}

# Filter precipitation and tetraterm temperature
monthlyClimate2 %>% 
  filter(logger == "Temperature" & month(date) %in% 6:9 | logger == "Precipitation") %>% 
  filter(year(date) != 2016) %>% 
  group_by(logger, T_level, P_level, year(date)) %>% 
  summarise(n = n(), mean = mean(value, na.rm = TRUE), sum = sum(value, na.rm = TRUE)) %>% 
  mutate(mean = ifelse(logger == "Precipitation", sum, mean)) %>% 
  group_by(logger, T_level, P_level) %>% 
  summarise(N = n(), Mean = mean(mean), SE = sd(mean, na.rm = TRUE) / sqrt(N)) %>% 
  unite(Mean_SE, Mean, SE, sep = "_") %>% 
  spread(key = logger, value = Mean_SE) %>% 
  separate(col = Precipitation, into = c("P_mean", "P_se"), sep = "_", convert = TRUE) %>% 
  separate(col = Temperature, into = c("T_mean", "T_se"), sep = "_", convert = TRUE) %>%
  ggplot(aes(x = P_mean, xmin = P_mean - P_se, xmax = P_mean + P_se, y = T_mean, ymin = T_mean -T_se, ymax = T_mean + T_se, color = P_level, shape = T_level)) +
  geom_errorbar() +
  geom_errorbarh() +
  geom_point(size = 3) +
  labs(x = "Annual precipitation in mm", y = "Tetraterm temperature in °C") +
  scale_color_manual(name = "Precipitation level", values = c("lightsteelblue1", "skyblue1", "steelblue3", "midnightblue")) +
  scale_shape_manual(name = "Temperature level", values = c(15, 16, 17)) +
  theme(legend.position = "top") +
  theme_minimal()
```

Figure S1.3. Grid of precipitation and tetraterm temperatures. Means of observations across years ± SE (vertical and horizontal error bars). Colors from light to dark blue are according to increasing precipitation levels (500mm, 1200mm, 2000mm, 2700mm). The shape of the symbols represent the temperature levels (boreal: square, sub-alpine: circle, alpine: triangle).


